name: RDP Server Secion Runer

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'üïê Operation Time for rdp'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h' 
        - '5h40m'

jobs:
  Premium-RDP-Setup:
    runs-on: windows-latest
    timeout-minutes: 340
    
    steps:
      # BANNER CH√ÄO M·ª™NG
      - name: Starting System
        run: |
          Write-Host ""
          Write-Host ""
          Write-Host "RDP Server on github" -ForegroundColor Yellow
          Write-Host "PC Spec: Amd Epyc/Intel Zeon - 16GB Ram - 256GB SSD(":C", ":D")" -ForegroundColor Green
          Write-Host "Running Time is: ${{ github.event.inputs.duration }}" -ForegroundColor Magenta
          Write-Host ""
          
          # Hi·ªáu ·ª©ng loading
          $frames = @('‚£æ', '‚£Ω', '‚£ª', '‚¢ø', '‚°ø', '‚£ü', '‚£Ø', '‚£∑')
          for($i=0; $i -lt 10; $i++) {
              Write-Host "`rSystem Is Starting... $($frames[$i % 8])" -NoNewline -ForegroundColor Blue
              Start-Sleep -Milliseconds 100
          }
          Write-Host "`rSystem Ready To Use!                    " -ForegroundColor Green

      # C·∫§U H√åNH N√ÇNG CAO
      - name: Changing settings
        run: |
          Write-Host ""
          Write-Host "Changing..." -ForegroundColor Yellow
          
          $steps = @(
              @{Name="B·∫≠t Remote Desktop"; Script={ 
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
              }},
              @{Name="T·∫Øt x√°c th·ª±c m·∫°ng"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
              }},
              @{Name="C·∫•u h√¨nh b·∫£o m·∫≠t RDP"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
              }},
              @{Name="M·ªü port 3389 firewall"; Script={
                  netsh advfirewall firewall add rule name="RDP-Premium" dir=in action=allow protocol=TCP localport=3389 profile=any
                  netsh advfirewall firewall add rule name="RDP-Premium-Out" dir=out action=allow protocol=TCP localport=3389 profile=any
              }},
              @{Name="Kh·ªüi ƒë·ªông d·ªãch v·ª•"; Script={
                  Set-Service -Name TermService -StartupType Automatic -ErrorAction SilentlyContinue
                  Set-Service -Name UmRdpService -StartupType Automatic -ErrorAction SilentlyContinue
                  Start-Service -Name TermService -ErrorAction SilentlyContinue
                  Start-Service -Name UmRdpService -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $steps) {
              Write-Host "‚îÇ üìã $($step.Name)..." -NoNewline -ForegroundColor White
              try {
                  & $step.Script
                  Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - ƒê√£ b·ªè qua l·ªói nh·ªè" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 500
          }
          
          Write-Host "Changing is finished!" -ForegroundColor Green

      # T·∫†O USER PREMIUM - (t·ªëi ∆∞u m·∫≠t kh·∫©u)
      - name: Creating New User
        run: |
          Write-Host ""
          Write-Host "Creating..." -ForegroundColor Yellow
          
          # H√†m t·∫°o password ng·∫Øn (8 k√Ω t·ª±) ƒë·∫£m b·∫£o c√≥ √≠t nh·∫•t 1 ch·ªØ hoa, 1 ch·ªØ th∆∞·ªùng, 1 s·ªë
          function New-PremiumPassword {
              param()
              $upper = 'ABCDEFGHJKLMNPQRSTUVWXYZ'   # lo·∫°i I,O ƒë·ªÉ tr√°nh nh·∫ßm
              $lower = 'abcdefghijkmnpqrstuvwxyz'
              $numbers = '23456789'               # lo·∫°i 0,1 ƒë·ªÉ tr√°nh nh·∫ßm
              $all = $upper + $lower + $numbers

              # ƒë·∫£m b·∫£o 1 ch·ªØ hoa, 1 ch·ªØ th∆∞·ªùng, 1 ch·ªØ s·ªë
              $pw = ''
              $pw += $upper[(Get-Random -Minimum 0 -Maximum $upper.Length)]
              $pw += $lower[(Get-Random -Minimum 0 -Maximum $lower.Length)]
              $pw += $numbers[(Get-Random -Minimum 0 -Maximum $numbers.Length)]

              # th√™m k√Ω t·ª± ng·∫´u nhi√™n ƒë·ªÉ ƒë·ªß 8 k√Ω t·ª±
              for ($i = 1; $i -le 5; $i++) {
                  $pw += $all[(Get-Random -Minimum 0 -Maximum $all.Length)]
              }

              # tr·ªôn ng·∫´u nhi√™n v·ªã tr√≠ c√°c k√Ω t·ª± r·ªìi tr·∫£ v·ªÅ
              return -join ($pw.ToCharArray() | Sort-Object { Get-Random })
          }

          # N·∫øu ng∆∞·ªùi d√πng ƒë·∫∑t m·∫≠t kh·∫©u t√πy ch·ªânh (v√≠ d·ª• b·∫±ng secret) th√¨ ∆∞u ti√™n d√πng
          if ($env:CUSTOM_RDP_PASS) {
              $matKhau = $env:CUSTOM_RDP_PASS
              Write-Host "‚îÇ ‚ÑπÔ∏è  D√πng m·∫≠t kh·∫©u t√πy ch·ªânh t·ª´ env" -ForegroundColor Blue
          } else {
              $matKhau = New-PremiumPassword
          }

          $securePass = ConvertTo-SecureString $matKhau -AsPlainText -Force
          
          # X√≥a user c≈© n·∫øu t·ªìn t·∫°i
          try {
              Remove-LocalUser -Name "Admin - RDP" -ErrorAction SilentlyContinue
              Write-Host "Old user deleted!" -ForegroundColor Green
          } catch {
              Write-Host "No User To Delete!" -ForegroundColor Blue
          }
          
          # T·∫°o user m·ªõi v·ªõi ƒë·∫ßy ƒë·ªß quy·ªÅn
          try {
              New-LocalUser -Name "Admin - RDP" -Password $securePass -AccountNeverExpires -Description "A Fully System Controled Account"
              Write-Host "Created!" -ForegroundColor Green
              
              # ƒê·∫∑t password kh√¥ng bao gi·ªù h·∫øt h·∫°n (d√πng Set-LocalUser n·∫øu c·∫ßn)
              try {
                  Set-LocalUser -Name "Admin - RDP" -PasswordNeverExpires $true -ErrorAction SilentlyContinue
              } catch {
                  # N·∫øu m√¥i tr∆∞·ªùng kh√¥ng h·ªó tr·ª£ Set-LocalUser, b·ªè qua an to√†n
              }

              # Th√™m v√†o c√°c nh√≥m c·∫ßn thi·∫øt
              Add-LocalGroupMember -Group "Administrators" -Member "Admin - RDP" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Remote Desktop Users" -Member "Admin - RDP" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Users" -Member "Admin - RDP" -ErrorAction SilentlyContinue
              
              # K√≠ch ho·∫°t user
              Enable-LocalUser -Name "Admin - RDP"
              
              Write-Host "Granted Administrator Permision to USER: Administrator & RDP" -ForegroundColor Green
              
          } catch {
              Write-Host "Error While Creating Account: $($_.Exception.Message)" -ForegroundColor Red
              exit 1
          }
          
          # L∆∞u th√¥ng tin (c·∫©n tr·ªçng n·∫øu repo public)
          echo "RDP_USER=Admin - RDP" >> $env:GITHUB_ENV
          echo "RDP_PASS=$matKhau" >> $env:GITHUB_ENV
          echo "$matKhau" > $env:TEMP\rdp_password.txt
          
          Write-Host "User Admin - RDP is ready to use!" -ForegroundColor Green

      # KI·ªÇM TRA QUY·ªÄN ƒêƒÇNG NH·∫¨P
      - name: Checking system permision of user
        run: |
          Write-Host ""
          Write-Host "Checking, Please Wait..." -ForegroundColor Yellow
          
          # Ki·ªÉm tra user t·ªìn t·∫°i
          $user = Get-LocalUser -Name "Admin - RDP" -ErrorAction SilentlyContinue
          if ($user) {
              Write-Host "User Is Exist!" -ForegroundColor Green
              Write-Host "Status: $($user.Enabled)" -ForegroundColor White
          } else {
              Write-Host "User isn't Exist!" -ForegroundColor Red
              exit 1
          }
          
          # Ki·ªÉm tra quy·ªÅn Administrator
          $isAdmin = (Get-LocalGroupMember -Group "Administrators" | Where-Object {$_.Name -like "*Admin - RDP"}).Count -gt 0
          if ($isAdmin) {
              Write-Host "User Has Administrator!" -ForegroundColor Green
          } else {
              Write-Host "User Hasn't Got Administrator" -ForegroundColor Red
          }
          
          # Ki·ªÉm tra quy·ªÅn Remote Desktop
          $isRDPUser = (Get-LocalGroupMember -Group "Remote Desktop Users" | Where-Object {$_.Name -like "*Admin - RDP"}).Count -gt 0
          if ($isRDPUser) {
              Write-Host "User Got Remote Desktop Working" -ForegroundColor Green
          } else {
              Write-Host "Remote Desktop Isn't Working On User" -ForegroundColor Red
          }
          
          # Ki·ªÉm tra d·ªãch v·ª• RDP
          $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
          if ($termService.Status -eq 'Running') {
              Write-Host "TermService Is Running!" -ForegroundColor Green
          } else {
              Write-Host "TermService Isn't Working!" -ForegroundColor Red
          }
          
          Write-Host "Check Finished!" -ForegroundColor Green

      # TAILSCALE PREMIUM
      - name: Setting Connection via Tailscale
        env:
          TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
        run: |
          Write-Host ""
          Write-Host "Installing Tailscale..." -ForegroundColor Yellow
          
          # C√†i ƒë·∫∑t Tailscale
          try {
              $msiPath = "$env:TEMP\tailscale-premium.msi"
              Invoke-WebRequest -Uri "https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi" -OutFile $msiPath
              Start-Process msiexec.exe -ArgumentList "/i", "`"$msiPath`"", "/quiet", "/norestart" -Wait
              Remove-Item $msiPath -Force -ErrorAction SilentlyContinue
              Write-Host "Tailscale Is Installed" -ForegroundColor Green
          } catch {
              Write-Host "Cannot Install Tailscale With Error" -ForegroundColor Red
          }
          
          # Ch·ªù d·ªãch v·ª• kh·ªüi ƒë·ªông
          Start-Sleep -Seconds 10
          
          # K·∫øt n·ªëi Tailscale
          try {
              & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=$env:TAILSCALE_AUTH_KEY --hostname=ai-stv-premium-$env:GITHUB_RUN_ID --accept-routes --accept-dns --reset
              Write-Host "Tailscale Connected!" -ForegroundColor Green
          } catch {
              Write-Host "Cannot Connect To Tailscale!" -ForegroundColor Red
          }
          
          # L·∫•y IP v·ªõi retry mechanism
          Write-Host "Getting IP Address" -NoNewline -ForegroundColor Blue
          $ip = $null
          for($i=0; $i -lt 20; $i++) {
              try {
                  $ip = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4 2>&1
                  if ($ip -and $ip -match '^\d+\.\d+\.\d+\.\d+$') {
                      echo "TAILSCALE_IP=$ip" >> $env:GITHUB_ENV
                      Write-Host "`rIP Address Is: $ip" -ForegroundColor Green
                      break
                  }
              } catch {
                  # B·ªè qua l·ªói v√† th·ª≠ l·∫°i
              }
              Write-Host "`rGetting IP Address... $(@('.', '..', '...')[$i % 3])" -NoNewline -ForegroundColor Blue
              Start-Sleep -Seconds 3
          }
          
          if (-not $ip -or $ip -notmatch '^\d+\.\d+\.\d+\.\d+$') {
              Write-Host "`rCannot Creating IP Address, Retry With Localhost" -ForegroundColor Yellow
              echo "TAILSCALE_IP=localhost" >> $env:GITHUB_ENV
          }

      # HI·ªÇN TH·ªä GIAO DI·ªÜN ƒê·∫∏P
      - name: Connection Info:
        run: |
          $matKhau = Get-Content $env:TEMP\rdp_password.txt -ErrorAction SilentlyContinue
          if (-not $matKhau) {
              $matKhau = "Cannot read the password"
          }
          
          # Chuy·ªÉn ƒë·ªïi th·ªùi gian t·ª´ input sang ph√∫t
          $durationInput = "${{ github.event.inputs.duration }}"
          switch ($durationInput) {
              "1h" { $totalMinutes = 60; $displayTime = "1 gi·ªù" }
              "3h" { $totalMinutes = 180; $displayTime = "3 gi·ªù" }
              "5h40m" { $totalMinutes = 340; $displayTime = "5 gi·ªù 40 ph√∫t" }
          }
          
          # T√≠nh th·ªùi gian ch√≠nh x√°c
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê" -ForegroundColor Cyan
          Write-Host "‚îÇ              CONNECTION INFOMATION                                     ‚îÇ" -ForegroundColor Cyan
          Write-Host "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§" -ForegroundColor Cyan
          Write-Host "‚îÇ üåê  IP Address: $env:TAILSCALE_IP" -ForegroundColor White
          Write-Host "‚îÇ üë§  Username: Admin - RDP" -ForegroundColor White
          Write-Host "‚îÇ üîê  Password: $matKhau" -ForegroundColor White
          Write-Host "‚îÇ ‚è∞  Duration: $displayTime" -ForegroundColor White
          Write-Host "‚îÇ üïê  Secion Start At: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "‚îÇ üïê  Secion Will End At: $($thoiGianKetThuc.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "‚îÇ üìç  Port: 3389" -ForegroundColor White
          Write-Host "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§" -ForegroundColor Cyan
          Write-Host "‚îÇ üí°  Instruction:                                    ‚îÇ" -ForegroundColor Cyan
          Write-Host "‚îÇ   1. Open Your Windows Remote Connect                |" -ForegroundColor Yellow
          Write-Host "|         If you use android/Ios;(IpadOS), please install windows app on:‚îÇ" -ForegroundColor Yellow
          Write-Host "|         Google Play Store (Android) | App Store (IOS/IpadOS)            |" -ForegroundColor Yellow
          Write-Host "‚îÇ   2. Type The Ip: $env:TAILSCALE_IP     Then Save It.‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   3. User: Admin - RDP | Password: $matKhau          ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   4. Enjoy! üöÄ                                    ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò" -ForegroundColor Cyan
          
          # L∆∞u th·ªùi gian v√†o bi·∫øn m√¥i tr∆∞·ªùng
          echo "TOTAL_MINUTES=$totalMinutes" >> $env:GITHUB_ENV

      # DUY TR√å PHI√äN ·ªîN ƒê·ªäNH
      - name: Stablize Secion...
        run: |
          $matKhau = Get-Content $env:TEMP\rdp_password.txt -ErrorAction SilentlyContinue
          $totalMinutes = $env:TOTAL_MINUTES
          
          # T√≠nh th·ªùi gian ch√≠nh x√°c
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "Starting stablize..." -ForegroundColor Yellow
          Write-Host "Secion: RDP Microsoft Wondows Server 2025" -ForegroundColor Magenta
          Write-Host "Connection: $env:TAILSCALE_IP" -ForegroundColor Cyan
          Write-Host "Start At: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor Green
          Write-Host "End At: $($thoiGianKetThuc.ToString('HH:mm:ss'))" -ForegroundColor Green
          Write-Host "Time Format: HH/MM/SS"
          
          # T·∫°o process gi√°m s√°t h·ªá th·ªëng
          $monitorScript = {
              $lastLogTime = Get-Date
              while ($true) {
                  $currentTime = Get-Date
                  
                  # Log tr·∫°ng th√°i m·ªói 2 ph√∫t
                  if (($currentTime - $lastLogTime).TotalMinutes -ge 2) {
                      # Ki·ªÉm tra d·ªãch v·ª•
                      $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
                      $rdpConnections = Get-NetTCPConnection -LocalPort 3389 -ErrorAction SilentlyContinue | Where-Object {$_.State -eq 'Established'}
                      
                      Write-Host "[$($currentTime.ToString('HH:mm:ss'))] RDP Connection Status: $($termService.Status), Connection: $($rdpConnections.Count)" -ForegroundColor Blue
                      $lastLogTime = $currentTime
                  }
                  
                  # Ki·ªÉm tra v√† kh·ªüi ƒë·ªông l·∫°i d·ªãch v·ª• n·∫øu c·∫ßn
                  $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
                  if ($termService.Status -ne 'Running') {
                      Write-Host "[$($currentTime.ToString('HH:mm:ss'))] Restarting TermService..." -ForegroundColor Yellow
                      Start-Service -Name TermService -ErrorAction SilentlyContinue
                  }
                  
                  Start-Sleep -Seconds 30
              }
          }
          
          # Ch·∫°y monitor trong background
          Start-Job -ScriptBlock $monitorScript -Name "SystemMonitor"
          
          # Hi·ªÉn th·ªã timer ch√≠nh
          $frames = @('‚†ã', '‚†ô', '‚†π', '‚†∏', '‚†º', '‚†¥', '‚†¶', '‚†ß', '‚†á', '‚†è')
          $colors = @('Red', 'Yellow', 'Green', 'Cyan', 'Blue', 'Magenta')
          $startTime = Get-Date
          
          do {
              $thoiGianHienTai = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
              $thoiGianConLai = $thoiGianKetThuc - $thoiGianHienTai
              
              $gioConLai = [math]::Max(0, [math]::Floor($thoiGianConLai.TotalHours))
              $phutConLai = [math]::Max(0, [math]::Floor($thoiGianConLai.TotalMinutes % 60))
              $giayConLai = [math]::Max(0, [math]::Floor($thoiGianConLai.TotalSeconds % 60))
              
              $frame = $frames[([int]((Get-Date) - $startTime).TotalSeconds) % $frames.Length]
              $color = $colors[([int]((Get-Date) - $startTime).TotalMinutes) % $colors.Length]
              
              Write-Host "`r$frame [$($thoiGianHienTai.ToString('HH:mm:ss'))] Th·ªùi gian c√≤n l·∫°i: $gioConLai gi·ªù $phutConLai ph√∫t $giayConLai gi√¢y" -NoNewline -ForegroundColor $color
              
              Start-Sleep -Seconds 5
              
          } while ($thoiGianConLai.TotalSeconds -gt 0)
          
          Write-Host ""
          Write-Host "Secion Ended Because Of Run Out Of Times" -ForegroundColor Red
          
          # D·ªçn d·∫πp jobs
          Get-Job -Name "SystemMonitor" -ErrorAction SilentlyContinue | Stop-Job -PassThru | Remove-Job -Force

      # D·ªåN D·∫∏P CHUY√äN NGHI·ªÜP
      - name: Cleaning System
        if: always()
        run: |
          Write-Host ""
          Write-Host "Cleaning System..." -ForegroundColor Yellow
          
          $cleanupSteps = @(
              @{Name="X√≥a file password"; Script={
                  Remove-Item "$env:TEMP\rdp_password.txt" -ErrorAction SilentlyContinue
              }},
              @{Name="V√¥ hi·ªáu h√≥a user"; Script={
                  Disable-LocalUser -Name "AISTV-PREMIUM" -ErrorAction SilentlyContinue
              }},
              @{Name="ƒê√≥ng k·∫øt n·ªëi m·∫°ng"; Script={
                  & "$env:ProgramFiles\Tailscale\tailscale.exe" down --accept-risk=all -ErrorAction SilentlyContinue
                  Start-Sleep -Seconds 5
              }},
              @{Name="X√≥a rule firewall"; Script={
                  netsh advfirewall firewall delete rule name="RDP-Premium" dir=in -ErrorAction SilentlyContinue
                  netsh advfirewall firewall delete rule name="RDP-Premium-Out" dir=out -ErrorAction SilentlyContinue
                  Remove-NetFirewallRule -DisplayName "RDP-Premium" -ErrorAction SilentlyContinue
                  Remove-NetFirewallRule -DisplayName "RDP-Premium-Out" -ErrorAction SilentlyContinue
              }},
              @{Name="Kh√¥i ph·ª•c c√†i ƒë·∫∑t RDP"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 1 -Force -ErrorAction SilentlyContinue
                  Stop-Service -Name TermService -Force -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $cleanupSteps) {
              Write-Host "‚îÇ üóëÔ∏è  $($step.Name)..." -NoNewline -ForegroundColor Gray
              try {
                  & $step.Script
                  Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - Safely Cleaned!" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 300
          }
          
          # D·ªçn d·∫πp jobs c√≤n s√≥t
          Get-Job | Stop-Job -PassThru | Remove-Job -Force -ErrorAction SilentlyContinue
          
          Write-Host ""
          Write-Host "Secion Is End, Thank For Using This Script, Feel Free To Fork It Without Credit!" -ForegroundColor Green
